<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Laporan Point — Taekwondo Ozone</title>

  <!-- Google Font -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;800&display=swap" rel="stylesheet">

  <!-- SheetJS for XLSX export -->
  <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>

  <style>
    :root{
      --bg: #f0f0f2;
      --card: rgba(255,255,255,0.65);
      --glass-border: rgba(255,255,255,0.55);
      --text: #111;
      --accent: rgba(255,255,255,0.9);
      --muted: rgba(0,0,0,0.45);
      --shadow: 12px 12px 24px rgba(0,0,0,0.08), -8px -8px 16px rgba(255,255,255,0.7) inset;
      --glass-padding: 18px;
      --radius: 18px;
      font-family: "Poppins", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }

    /* Dark mode variables */
    .dark {
      --bg: #000000;
      --card: rgba(255,255,255,0.04);
      --glass-border: rgba(255,255,255,0.06);
      --text: #f4f4f5;
      --accent: rgba(255,255,255,0.96);
      --muted: rgba(255,255,255,0.18);
      --shadow: 0 6px 18px rgba(0,0,0,0.6), -8px -8px 16px rgba(255,255,255,0.02) inset;
    }

    html,body{
      height:100%;
      margin:0;
      background: radial-gradient(circle at 10% 10%, rgba(0,0,0,0.02), transparent 10%),
                  linear-gradient(180deg, var(--bg), #dcdcdc 80%);
      color:var(--text);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      box-sizing:border-box;
    }

    *{box-sizing:border-box}

    .container{
      max-width:1160px;
      margin:28px auto;
      padding:22px;
    }

    /* Header */
    .header {
      display:flex;
      align-items:center;
      gap:18px;
      justify-content:space-between;
      margin-bottom:18px;
    }

    .title {
      display:flex;
      align-items:center;
      gap:14px;
    }

    .brand {
      font-weight:800;
      letter-spacing:1px;
      font-size:28px;
      padding:10px 18px;
      border-radius:14px;
      background: linear-gradient(180deg, rgba(255,255,255,0.12), rgba(255,255,255,0.04));
      box-shadow: var(--shadow);
      color:var(--accent);
      -webkit-backdrop-filter: blur(8px);
      backdrop-filter: blur(8px);
    }

    .searchwrap{
      flex:1;
      display:flex;
      justify-content:center;
      padding:0 12px;
    }

    .search {
      width:60%;
      min-width:220px;
      max-width:520px;
      background:var(--card);
      border-radius:40px;
      padding:8px 14px;
      display:flex;
      align-items:center;
      gap:10px;
      border:1px solid var(--glass-border);
      box-shadow: var(--shadow);
      -webkit-backdrop-filter: blur(6px);
      backdrop-filter: blur(6px);
    }

    .search input{
      border:0;
      outline:0;
      background:transparent;
      color:var(--text);
      font-weight:600;
      width:100%;
      font-size:14px;
    }

    .actions {
      display:flex;
      gap:10px;
      align-items:center;
    }

    .btn {
      padding:10px 14px;
      border-radius:12px;
      border:1px solid var(--glass-border);
      background:var(--card);
      color:var(--accent);
      font-weight:700;
      cursor:pointer;
      box-shadow: var(--shadow);
      -webkit-backdrop-filter: blur(6px);
      backdrop-filter: blur(6px);
    }
    .btn.ghost { background:transparent; color:var(--text); border:1px solid rgba(0,0,0,0.06); }
    .btn.small { padding:6px 10px; font-size:13px; border-radius:10px; }

    /* Form */
    .card {
      background:var(--card);
      border-radius:var(--radius);
      padding:var(--glass-padding);
      border:1px solid var(--glass-border);
      box-shadow: var(--shadow);
      -webkit-backdrop-filter: blur(8px);
      backdrop-filter: blur(8px);
      margin-bottom:18px;
    }

    .form-grid {
      display:grid;
      grid-template-columns: 1fr 110px 1fr 120px auto;
      gap:12px;
      align-items:center;
    }
    .form-grid input, .form-grid select {
      padding:12px 14px;
      border-radius:10px;
      border:1px solid rgba(0,0,0,0.06);
      background:rgba(255,255,255,0.5);
      outline:none;
      font-weight:600;
    }
    .form-grid input[type="date"]{ padding:10px 12px; font-weight:500; }

    .table-wrap {
      overflow:auto;
      border-radius:14px;
      padding:12px;
      background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02));
      border:1px solid var(--glass-border);
      box-shadow: var(--shadow);
    }

    table {
      width:100%;
      border-collapse:collapse;
      min-width:720px;
    }
    thead th {
      text-align:left;
      padding:16px 12px;
      font-weight:700;
      letter-spacing:0.6px;
      cursor:pointer;
      user-select:none;
    }
    tbody td {
      padding:14px 12px;
      font-weight:700;
    }

    tr + tr td {
      border-top: 10px solid transparent;
    }

    .col-name{ width:35%; }
    .col-point{ width:8%; text-align:center; }
    .col-date{ width:20%; text-align:center; }
    .col-keg{ width:18%; text-align:center; }
    .col-aksi{ width:12%; text-align:center; }

    .pill {
      display:inline-block;
      padding:10px 16px;
      border-radius:12px;
      background:var(--card);
      color:var(--accent);
      font-weight:800;
      box-shadow: var(--shadow);
      border:1px solid var(--glass-border);
      -webkit-backdrop-filter: blur(6px);
      backdrop-filter: blur(6px);
    }

    .small-muted { font-size:13px; color:var(--muted); font-weight:600; }

    .row-ops {
      display:flex;
      gap:8px;
      justify-content:center;
    }

    .icon-btn {
      padding:8px 12px;
      border-radius:10px;
      border:1px solid var(--glass-border);
      background:var(--card);
      cursor:pointer;
      font-weight:700;
      box-shadow: var(--shadow);
    }

    /* Modal */
    .modal-backdrop{
      position:fixed;
      inset:0;
      background:rgba(0,0,0,0.45);
      display:none;
      align-items:center;
      justify-content:center;
      z-index:9999;
    }
    .modal{
      width:88%;
      max-width:520px;
      border-radius:18px;
      padding:20px;
      background:var(--card);
      border:1px solid var(--glass-border);
      box-shadow: 0 10px 40px rgba(0,0,0,0.5);
      -webkit-backdrop-filter: blur(6px);
      backdrop-filter: blur(6px);
      text-align:center;
    }
    .modal h3{ margin:6px 0 12px 0; font-size:20px; }
    .modal p{ color:var(--muted); font-weight:600; margin-bottom:18px; }

    /* Footer small */
    .footer-note { margin-top:12px; font-size:13px; color:var(--muted); text-align:right; }

    /* Responsive */
    @media (max-width:900px){
      .form-grid{ grid-template-columns: 1fr; }
      .search{ width:100%; }
      table{ min-width:700px; }
    }
    @media (max-width:520px){
      table{ min-width:620px; }
    }

  </style>
</head>
<body>
  <div class="container" id="app">
    <div class="header">
      <div class="title">
        <div class="brand">LAPORAN POINT</div>
      </div>

      <div class="searchwrap">
        <div class="search">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" style="opacity:.85"><path d="M21 21l-4.35-4.35" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/><circle cx="11" cy="11" r="6" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/></svg>
          <input id="globalSearch" placeholder="Cari nama, kegiatan..." />
        </div>
      </div>

      <div class="actions">
        <button class="btn small" id="toggleTheme">Mode Gelap</button>
        <button class="btn" id="exportCsv">Export CSV</button>
        <button class="btn" id="exportXlsx">Export XLSX</button>
      </div>
    </div>

    <!-- Input card -->
    <div class="card">
      <form id="entryForm" class="form-grid" onsubmit="return false;">
        <input id="nameInput" placeholder="Nama ..." required />
        <input id="pointInput" placeholder="Point ..." />
        <input id="dateInput" type="date" />
        <input id="kegInput" placeholder="Kegiatan ..." />
        <div style="display:flex; gap:8px; align-items:center;">
          <button id="addBtn" class="btn" type="button">Tambah</button>
          <button id="updateBtn" class="btn ghost" style="display:none" type="button">Simpan Perubahan</button>
          <button id="resetBtn" class="btn ghost small" type="button">Reset</button>
        </div>
      </form>
    </div>

    <!-- Table -->
    <div class="table-wrap card">
      <table id="dataTable">
        <thead>
          <tr>
            <th class="col-name" data-key="name">NAMA ▲▼</th>
            <th class="col-point" data-key="point">POINT</th>
            <th class="col-date" data-key="date">TANGGAL</th>
            <th class="col-keg" data-key="kegiatan">KEGIATAN</th>
            <th class="col-aksi">AKSI</th>
          </tr>
        </thead>
        <tbody id="tableBody">
          <!-- rows -->
        </tbody>
      </table>
      <div class="footer-note">Taekwondo Ozone • Tampilan kaca (glass) • Data disimpan di browser</div>
    </div>
  </div>

  <!-- Delete Confirmation Modal -->
  <div class="modal-backdrop" id="modalBackdrop">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modaltitle">
      <h3 id="modaltitle">Konfirmasi Hapus</h3>
      <p id="modalMsg">Apakah Anda yakin ingin menghapus entri ini?</p>
      <div style="display:flex; gap:10px; justify-content:center;">
        <button class="btn" id="confirmDelete">Ya, Hapus</button>
        <button class="btn ghost" id="cancelDelete">Batal</button>
      </div>
    </div>
  </div>

  <script>
    /***********************
     * App State & Helpers
     ***********************/
    const LS_KEY = "laporan_point_data_v1";
    let data = []; // array of { id, name, point, date (ISO), kegiatan }
    let editingId = null;
    let sortState = { key: 'name', dir: 'asc' };

    const $ = (sel)=> document.querySelector(sel);
    const $$ = (sel)=> document.querySelectorAll(sel);

    // Load from localStorage
    function loadData(){
      try {
        const raw = localStorage.getItem(LS_KEY);
        data = raw ? JSON.parse(raw) : getSampleData();
      } catch(e){ data = getSampleData(); }
    }
    function saveData(){
      localStorage.setItem(LS_KEY, JSON.stringify(data));
    }

    function getSampleData(){
      // sample initial rows
      return [
        { id: genId(), name: "DAFFA", point: "20", date: new Date().toISOString().slice(0,10), kegiatan: "LATIHAN" },
        { id: genId(), name: "FAREL", point: "21", date: new Date().toISOString().slice(0,10), kegiatan: "LATIHAN" },
        { id: genId(), name: "JOKOWI", point: "18", date: new Date().toISOString().slice(0,10), kegiatan: "LATIHAN" }
      ];
    }

    function genId(){ return 'id_'+Math.random().toString(36).slice(2,9); }

    function formatDisplayDate(iso){
      if(!iso) return "";
      const d = new Date(iso);
      const dd = String(d.getDate()).padStart(2,'0');
      const mm = String(d.getMonth()+1).padStart(2,'0');
      const yy = d.getFullYear();
      return `${dd}/${mm}/${yy}`;
    }

    /***********************
     * DOM Refs
     ***********************/
    const el = {
      name: $("#nameInput"),
      point: $("#pointInput"),
      date: $("#dateInput"),
      keg: $("#kegInput"),
      addBtn: $("#addBtn"),
      updateBtn: $("#updateBtn"),
      resetBtn: $("#resetBtn"),
      tableBody: $("#tableBody"),
      globalSearch: $("#globalSearch"),
      toggleTheme: $("#toggleTheme"),
      modalBackdrop: $("#modalBackdrop"),
      confirmDelete: $("#confirmDelete"),
      cancelDelete: $("#cancelDelete"),
      exportCsv: $("#exportCsv"),
      exportXlsx: $("#exportXlsx")
    };

    /***********************
     * Rendering
     ***********************/
    function renderTable(){
      // copy filtered + sorted data
      const q = el.globalSearch.value.trim().toLowerCase();
      let rows = data.filter(r=>{
        if(!q) return true;
        return (r.name||"").toLowerCase().includes(q) ||
               (r.kegiatan||"").toLowerCase().includes(q) ||
               (r.point||"").toLowerCase().includes(q) ||
               formatDisplayDate(r.date).toLowerCase().includes(q);
      });

      // sort
      rows.sort((a,b)=>{
        const k = sortState.key;
        let va = (a[k]||"")+''; let vb = (b[k]||"")+''; 
        if(k === 'date'){ va = a.date || ''; vb = b.date || ''; }
        if(k === 'point'){
          // numeric-ish sort attempt
          const na = parseFloat(a.point); const nb = parseFloat(b.point);
          if(!isNaN(na) && !isNaN(nb)) {
            return sortState.dir === 'asc' ? na - nb : nb - na;
          }
        }
        if(va < vb) return sortState.dir === 'asc' ? -1 : 1;
        if(va > vb) return sortState.dir === 'asc' ? 1 : -1;
        return 0;
      });

      el.tableBody.innerHTML = "";
      rows.forEach(row=>{
        const tr = document.createElement("tr");

        // name
        const tdName = document.createElement("td");
        tdName.className = "col-name";
        tdName.innerHTML = `<div class="pill">${escapeHtml(row.name||'')}</div>`;
        tr.appendChild(tdName);

        // point
        const tdPoint = document.createElement("td");
        tdPoint.className = "col-point";
        tdPoint.innerHTML = `<div class="small-muted">${escapeHtml(row.point||'')}</div>`;
        tr.appendChild(tdPoint);

        // date
        const tdDate = document.createElement("td");
        tdDate.className = "col-date";
        tdDate.innerHTML = `<div class="small-muted">${formatDisplayDate(row.date)}</div>`;
        tr.appendChild(tdDate);

        // kegiatan
        const tdKeg = document.createElement("td");
        tdKeg.className = "col-keg";
        tdKeg.innerHTML = `<div class="small-muted">${escapeHtml(row.kegiatan||'')}</div>`;
        tr.appendChild(tdKeg);

        // aksi
        const tdAksi = document.createElement("td");
        tdAksi.className = "col-aksi";
        tdAksi.innerHTML = `
          <div class="row-ops">
            <button class="icon-btn" data-act="edit" data-id="${row.id}">EDIT</button>
            <button class="icon-btn" data-act="delete" data-id="${row.id}">HAPUS</button>
          </div>`;
        tr.appendChild(tdAksi);

        el.tableBody.appendChild(tr);
      });

      // wire up edit/delete buttons
      el.tableBody.querySelectorAll('[data-act]').forEach(btn=>{
        btn.onclick = (ev)=>{
          const act = btn.getAttribute('data-act');
          const id = btn.getAttribute('data-id');
          if(act === 'edit') startEdit(id);
          else if(act === 'delete') confirmDelete(id);
        };
      });
    }

    /***********************
     * CRUD Actions
     ***********************/
    function addEntry(){
      const name = el.name.value.trim();
      const point = el.point.value.trim();
      const date = el.date.value || null;
      const keg = el.keg.value.trim();
      if(!name){
        alert("Nama diperlukan.");
        return;
      }
      const item = { id: genId(), name, point, date, kegiatan: keg };
      data.unshift(item);
      saveData();
      clearForm();
      renderTable();
    }

    function startEdit(id){
      const rec = data.find(r=>r.id===id);
      if(!rec) return;
      editingId = id;
      el.name.value = rec.name || "";
      el.point.value = rec.point || "";
      el.date.value = rec.date || "";
      el.keg.value = rec.kegiatan || "";
      el.addBtn.style.display = "none";
      el.updateBtn.style.display = "inline-block";
      window.scrollTo({top:0, behavior:'smooth'});
    }

    function applyUpdate(){
      if(!editingId) return;
      const rec = data.find(r=>r.id===editingId);
      if(!rec) return;
      rec.name = el.name.value.trim();
      rec.point = el.point.value.trim();
      rec.date = el.date.value || null;
      rec.kegiatan = el.keg.value.trim();
      saveData();
      editingId = null;
      el.addBtn.style.display = "inline-block";
      el.updateBtn.style.display = "none";
      clearForm();
      renderTable();
    }

    function clearForm(){
      el.name.value = "";
      el.point.value = "";
      el.date.value = "";
      el.keg.value = "";
      editingId = null;
      el.addBtn.style.display = "inline-block";
      el.updateBtn.style.display = "none";
    }

    /***********************
     * Delete Modal
     ***********************/
    let pendingDeleteId = null;
    function confirmDelete(id){
      pendingDeleteId = id;
      $("#modalMsg").textContent = "Yakin ingin menghapus entri ini? Tindakan ini tidak dapat dibatalkan.";
      el.modalBackdrop.style.display = "flex";
    }
    function cancelDelete(){
      pendingDeleteId = null;
      el.modalBackdrop.style.display = "none";
    }
    function doDelete(){
      if(!pendingDeleteId) return;
      data = data.filter(r=>r.id !== pendingDeleteId);
      saveData();
      pendingDeleteId = null;
      el.modalBackdrop.style.display = "none";
      renderTable();
    }

    /***********************
     * Exports
     ***********************/
    function exportCSV(){
      // header
      const header = ["Nama","Point","Tanggal","Kegiatan"];
      const rows = data.map(r=>[
        r.name || '',
        r.point || '',
        formatDisplayDate(r.date) || '',
        r.kegiatan || ''
      ]);
      const csv = [header, ...rows].map(row=>row.map(cell=>`"${String(cell).replace(/"/g,'""')}"`).join(",")).join("\n");
      const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      downloadUrl(url, "laporan_point.csv");
      setTimeout(()=>URL.revokeObjectURL(url), 1000);
    }

    function exportXLSX(){
      // Using SheetJS (XLSX)
      const ws_data = [
        ["Nama","Point","Tanggal","Kegiatan"],
        ...data.map(r=>[r.name||'', r.point||'', formatDisplayDate(r.date)||'', r.kegiatan||''])
      ];
      const ws = XLSX.utils.aoa_to_sheet(ws_data);
      const wb = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(wb, ws, "Laporan");
      const wbout = XLSX.write(wb, { bookType:'xlsx', type:'array' });
      const blob = new Blob([wbout],{type:"application/octet-stream"});
      const url = URL.createObjectURL(blob);
      downloadUrl(url, "laporan_point.xlsx");
      setTimeout(()=>URL.revokeObjectURL(url), 1500);
    }

    function downloadUrl(url, filename){
      const a = document.createElement('a');
      a.href = url;
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      a.remove();
    }

    /***********************
     * Utils & Events
     ***********************/
    function escapeHtml(s){
      return String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
    }

    // Header sort clicks
    document.querySelectorAll('thead th[data-key]').forEach(th=>{
      th.addEventListener('click', ()=>{
        const k = th.getAttribute('data-key');
        if(sortState.key === k) sortState.dir = sortState.dir === 'asc' ? 'desc' : 'asc';
        else { sortState.key = k; sortState.dir = 'asc'; }
        renderTable();
      });
    });

    // Wiring buttons
    el.addBtn.addEventListener('click', addEntry);
    el.updateBtn.addEventListener('click', applyUpdate);
    el.resetBtn.addEventListener('click', clearForm);
    el.globalSearch.addEventListener('input', ()=>renderTable());
    el.cancelDelete.addEventListener('click', cancelDelete);
    el.confirmDelete.addEventListener('click', doDelete);
    el.exportCsv.addEventListener('click', exportCSV);
    el.exportXlsx.addEventListener('click', exportXLSX);

    // Modal backdrop click closes on outside click
    el.modalBackdrop.addEventListener('click', (e)=>{
      if(e.target === el.modalBackdrop) cancelDelete();
    });

    // Theme toggle (manual only)
    const root = document.documentElement;
    let isDark = false;
    function applyTheme(){
      document.body.classList.toggle('dark', isDark);
      $("#toggleTheme").textContent = isDark ? "Mode Terang" : "Mode Gelap";
    }
    $("#toggleTheme").addEventListener('click', ()=>{
      isDark = !isDark;
      applyTheme();
      // optionally persist theme in localStorage
      localStorage.setItem('laporan_point_theme', isDark ? 'dark' : 'light');
    });

    // Load stored theme
    (function initTheme(){
      const t = localStorage.getItem('laporan_point_theme');
      if(t) isDark = t === 'dark';
      applyTheme();
    })();

    // Init
    (function init(){
      loadData();
      renderTable();
    })();

  </script>
</body>
</html>
